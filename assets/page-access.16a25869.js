var j=Object.defineProperty;var W=(a,l,n)=>l in a?j(a,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[l]=n;var w=(a,l,n)=>(W(a,typeof l!="symbol"?l+"":l,n),n),B=(a,l,n)=>{if(!l.has(a))throw TypeError("Cannot "+n)};var k=(a,l,n)=>(B(a,l,"read from private field"),n?n.call(a):l.get(a)),F=(a,l,n)=>{if(l.has(a))throw TypeError("Cannot add the same private member more than once");l instanceof WeakSet?l.add(a):l.set(a,n)},P=(a,l,n,r)=>(B(a,l,"write to private field"),r?r.call(a,n):l.set(a,n),n);import{a as q,u as M}from"./vue-router.35a42f14.js";import{d as H,e as Y,f as L,g as G,h as Q,i as A}from"./element-plus.c6cd903c.js";import{o as J,g as R,J as z,h as $,P as K,I as x,aq as e,n as U,v as f,p as Z}from"./vue-1679627587.35c701e1.js";import{_ as V,r as E}from"./layout.f3c0a27e.js";import{I as ee,d as te,b as ae}from"./utils.0cc7f138.js";const le={};const ne={class:"layout-container"};function se(a,l,n,r,u,i){return J(),R("main",ne,[z(a.$slots,"default")])}const oe=V(le,[["render",se]]),ie={props:{rightWidth:{type:String,default:"210px"}}};const ue={ref:"wrap",class:"clearfix layout-search"},re={class:"alignment"};function ce(a,l,n,r,u,i){return J(),R("div",ue,[$("div",{class:"left",style:K({width:`calc(100% - ${n.rightWidth})`})},[z(a.$slots,"left")],4),$("div",{ref:"right",class:"right",style:K({width:n.rightWidth})},[$("div",re,[z(a.$slots,"right")])],4)],512)}const de=V(ie,[["render",ce]]);const X=x({props:{},setup(a){const l=U();return()=>e(e(H,{modelValue:!0,...a},{...l.slots}))}}),pe=x({setup(a){return()=>e(e(Y,{...a}))}});const he=x({props:{storageKey:{type:String,required:!0},inputList:{type:Array,default:()=>[]},buttonList:{type:Array,default:()=>[]},rightWidth:{type:String,default:"160px"}},setup(a){const n="searchShrink_"+a.storageKey,r=f(!1),u=f([]),i=f([]),p=f([]);v();function v(){const t=a.storageKey?JSON.parse(localStorage.getItem(n)):null;if(t){const s=t.showInputList.concat(t.hiddenInputList);s.forEach(o=>{if(a.inputList.findIndex(h=>h.label===o)<0){const h=t.showInputList.findIndex(b=>b===o);h>=0&&t.showInputList.splice(h,1);const c=t.hiddenInputList.findIndex(b=>b===o);c>=0&&t.hiddenInputList.splice(c,1)}}),a.inputList.forEach(o=>{s.findIndex(h=>o.label===h)<0&&t.showInputList.push(o.label)}),u.value=t.showInputList,i.value=t.hiddenInputList}else C();m()}function m(){const t=[];u.value.forEach(s=>{const o=a.inputList.find(d=>s===d.label);t.push(o)}),p.value=t,a.storageKey&&localStorage.setItem(n,JSON.stringify({showInputList:u.value.filter(s=>s),hiddenInputList:i.value.filter(s=>s)})),r.value=!1}function y(){u.value=u.value.concat(i.value),i.value=[]}function C(){u.value=a.inputList.map(t=>t.label),i.value=[]}function S(t){const s=i.value.findIndex(o=>o===t);s<0||(i.value.splice(s,1),u.value.push(t))}function g(t){const s=u.value.findIndex(o=>o===t);s<0||(u.value.splice(s,1),i.value.push(t))}return()=>e(e("div",{class:"input-search-shrink"},e("div",{class:"custom-column"},e("span",{onClick:()=>r.value=!0},"\u2699\uFE0E")),e(de,{rightWidth:a.rightWidth,style:"margin-right: 20px"},{left:()=>e("div",null,a.inputList.map(t=>p.value.findIndex(o=>t.label===o.label)>=0?e("div",{class:"input-item"},t.slots):null)),right:()=>e("div",{class:"clearfix"},a.buttonList.map(t=>e("div",{class:"button-item"},t)))}),e(X,{title:"\u663E\u793A\u641C\u7D22\u6846",modelValue:r.value,onClose:()=>r.value=!1},{default:()=>e("div",{class:"table-shrink-wrap"},e("div",{class:"yet-add"},u.value.map((t,s)=>e("span",{key:s,class:"item",onClick:()=>{g(t)}},t,e("span",{class:"icon-del"},"-")))),e("div",{class:"line"}),e("div",{class:"no-add"},i.value.map(t=>e("span",{class:"item",onClick:()=>{S(t)}},t,e("span",{class:"icon-add"},"+"))))),footer:()=>e("span",{class:"dialog-footer btn"},e("div",{class:"btn-left"},e("div",{class:"add-all",onClick:y},"\u6DFB\u52A0\u5168\u90E8"),e("div",{class:"reset",onClick:C},"\u91CD\u7F6E")),e("div",null,e(L,{size:"small",onClick:()=>r.value=!1},{default:()=>"\u53D6\u6D88"}),e(L,{size:"small",type:"primary",onClick:()=>m()},{default:()=>"\u4FDD\u5B58"})))})))}}),fe=x({props:{tableProps:{type:Object,default:()=>({})},tableColumnProps:{type:Object,default:()=>[]}},setup(a){return()=>e(e(G,{...a.tableProps},{default:()=>a.tableColumnProps.map(l=>e(Q,{showOverflowTooltip:!0,...l},l.slots?l.slots:null))}))}});const me=x({props:{storageKey:{type:String,required:!0},tableColumnProps:{type:Array,default:()=>[]},tableProps:{type:Object,default:()=>({})}},setup(a){const n="tableShrink_"+a.storageKey,r=f(!1),u=f([]),i=f([]),p=f([]);v();function v(){const t=a.storageKey?JSON.parse(localStorage.getItem(n)):null,s=a.tableColumnProps.filter(o=>o.prop&&o.label).map(o=>({prop:o.prop,label:o.label}));if(t){const o=t.showColumnList.concat(t.hiddenColumnList);o.forEach(d=>{if(s.findIndex(c=>c.label===d.label&&c.prop===d.label)<0){const c=t.showColumnList.findIndex(D=>D.label===d.label&&D.prop===d.label);c>=0&&t.showColumnList.splice(c,1);const b=t.hiddenColumnList.findIndex(D=>D.label===d.label&&D.prop===d.label);b>=0&&t.hiddenColumnList.splice(b,1)}}),s.forEach(d=>{o.findIndex(c=>c.label===d.label&&c.prop===d.prop)<0&&t.showColumnList.push(d)}),u.value=t.showColumnList,i.value=t.hiddenColumnList}else m();g()}function m(){u.value=a.tableColumnProps.filter(t=>t.prop&&t.label).map(t=>({prop:t.prop,label:t.label})),i.value=[]}function y(){u.value=u.value.concat(i.value),i.value=[]}function C(t){const s=i.value.findIndex(o=>o.prop===t.prop&&o.label===t.label);i.value.splice(s,1),u.value.push(t)}function S(t){const s=u.value.findIndex(o=>o.prop===t.prop&&o.label===t.label);u.value.splice(s,1),i.value.push(t)}g();function g(){const t=[];a.tableColumnProps.forEach(s=>{(!s.prop||!s.label)&&t.push(s)}),u.value.forEach(s=>{const o=a.tableColumnProps.find(d=>s.prop===d.prop&&s.label===d.label);o&&t.push(o)}),p.value=t,a.storageKey&&localStorage.setItem(n,JSON.stringify({showColumnList:u.value,hiddenColumnList:i.value})),r.value=!1}return()=>e(e("div",{class:"table-shrink"},e("div",{class:"custom-column"},e("span",{onClick:()=>r.value=!0},"\u2699\uFE0E")),e(fe,{tableProps:a.tableProps,tableColumnProps:p.value}),e(X,{title:"\u8868\u5934\u663E\u793A",modelValue:r.value,onClose:()=>r.value=!1},{default:()=>e("div",{class:"table-shrink-wrap"},e("div",{class:"yet-add"},u.value.map((t,s)=>e("span",{key:s,class:"item"},t.label,e("span",{class:"icon-del",onClick:()=>S(t)},"-")))),e("div",{class:"line"}),e("div",{class:"no-add"},i.value.map((t,s)=>e("span",{key:s,class:"item"},t.label,e("span",{class:"icon-add",onClick:()=>C(t)},"+"))))),footer:()=>e("span",{class:"dialog-footer btn"},e("div",{class:"btn-left"},e("div",{class:"add-all",onClick:y},"\u6DFB\u52A0\u5168\u90E8"),e("div",{class:"reset",onClick:m},"\u91CD\u7F6E")),e("div",null,e(L,{size:"small",onClick:()=>r.value=!1},{default:()=>"\u53D6\u6D88"}),e(L,{size:"small",type:"primary",onClick:g},{default:()=>"\u4FDD\u5B58"})))})))}}),ge="_menu_1ozo4_1",be="_content_1ozo4_1",ve="_active_1ozo4_27",T={menu:ge,content:be,active:ve};function O(a){return E({url:"/access",method:"get",params:a})}function Ee(a){return E({url:"/access/chart",method:"get",params:a})}function ye(a){return E({url:"/file/read",method:"get",params:a})}function Fe(a){return E({url:"/file/read/logs",method:"get",params:a})}const Ce={ip:"",url:"",time:[Date.now(),Date.now()]};var _,I;class _e extends ee{constructor(){super(Ce,O);F(this,_,null);F(this,I,null);w(this,"nowDay",f());w(this,"menuList",f([]));w(this,"changeMenu",n=>{k(this,I).replace({query:{log:n.name}}),this.paging.pageNumber=1,this.initData()});w(this,"initData",async()=>{const r=new Date(this.nowDay.value).getTime()-288e5,u=r+36e5*24,i=te({startTime:r/1e3,endTime:u/1e3-1,pageNumber:this.paging.pageNumber,pageSize:this.paging.pageSize,...this.form}),[p,v]=await O(i);if(p){this.tableData.value=[],this.paging.total=0;return}const{list:m,total:y}=v.data;this.tableData.value=m,this.paging.total=y});P(this,_,q()),P(this,I,M());const n=this;(async function(){const[r,u]=await ye({path:"/access"});if(r)return;const i=u.data.reverse();n.menuList.value=i;const p=k(n,_).query.log;p?(n.nowDay.value=p.replace(".log",""),n.initData()):k(n,I).replace({query:{log:i[0].name}})})(),Z(()=>k(this,_).query.log,r=>{r&&(this.nowDay.value=r.replace(".log",""),this.initData())}),this.initData()}}_=new WeakMap,I=new WeakMap;const N="page-access",Ie=x(()=>{const a=q(),{paging:l,onCurrentChange:n,onSizeChange:r,pagingIndex:u,form:i,search:p,reset:v,tableData:m,initData:y,menuList:C,changeMenu:S}=new _e;function g(c){c.keyCode===13&&p()}const t=()=>e(he,{storageKey:N,inputList:[{label:"IP\u5730\u5740",slots:e(A,{placeholder:"\u8BF7\u8F93\u5165IP\u5730\u5740",modelValue:i.ip,onInput:c=>i.ip=c,onKeydown:g,onClear:p})},{label:"\u8BF7\u6C42\u8DEF\u5F84",slots:e(A,{placeholder:"\u8BF7\u8F93\u5165\u8BF7\u6C42\u8DEF\u5F84",modelValue:i.url,onInput:c=>i.url=c,onKeydown:g,onClear:p})}],buttonList:[e(L,{type:"primary",onClick:p},{default:()=>"\u641C\u7D22"}),e(L,{onClick:v},{default:()=>"\u91CD\u7F6E"})]}),s=()=>e(pe,{defaultCurrentPage:l.pageNumber,defaultPageSize:l.pageSize,total:l.total,onCurrentChange:n,onSizeChange:r}),o=[{label:"\u5E8F\u53F7",width:60,slots:c=>u(l.pageNumber,l.pageSize,c.$index)},{prop:"ip",label:"IP",width:150},{prop:"accessTime",label:"\u8BBF\u95EE\u65F6\u95F4",width:160,slots:c=>ae(c.row.accessTime*1e3)},{prop:"userAgent",label:"userAgent"},{prop:"url",label:"PATH"}],d=()=>e(me,{storageKey:N,tableProps:{data:m.value},tableColumnProps:o}),h=()=>e(e("ul",{class:T.menu},C.value.map((c,b)=>e("li",{key:b,class:c.name===a.query.log?T.active:"",onClick:()=>S(c)},c.name))));return()=>e(e(oe,null,{default:()=>[e(h,null),e("div",{class:T.content},e(t,null),e(d,null),e(s,null))]}))}),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{pe as E,oe as L,he as S,X as T,Fe as a,de as b,me as c,Ee as d,Pe as i};
